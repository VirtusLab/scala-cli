"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4844],{2267:(e,t,a)=>{a.d(t,{Z:()=>l,b:()=>s});a(6540);var n=a(9487),i=a(4848);function l({children:e}){return(0,i.jsx)("div",{className:"runnable-command",children:e})}function s({url:e}){return(0,i.jsx)(n.A,{playing:!0,loop:!0,muted:!0,controls:!0,width:"100%",height:"",url:e})}},8306:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"cookbooks/introduction/instant-startup-scala-scripts","title":"Scripts with instant startup","description":"Scala CLI allows to easly compile and run Scala Scripts.","source":"@site/docs/cookbooks/introduction/instant-startup-scala-scripts.md","sourceDirName":"cookbooks/introduction","slug":"/cookbooks/introduction/instant-startup-scala-scripts","permalink":"/docs/cookbooks/introduction/instant-startup-scala-scripts","draft":false,"unlisted":false,"editUrl":"https://github.com/Virtuslab/scala-cli/edit/main/website/docs/cookbooks/introduction/instant-startup-scala-scripts.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Scripts with instant startup","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Running Scala Scripts","permalink":"/docs/cookbooks/introduction/scala-scripts"},"next":{"title":"GitHub gists","permalink":"/docs/cookbooks/introduction/gists"}}');var i=a(4848),l=a(8453),s=a(2267);const r={title:"Scripts with instant startup",sidebar_position:7},o=void 0,c={},d=[{value:"Using Scala Native",id:"using-scala-native",level:2},{value:"Optimization options",id:"optimization-options",level:2},{value:"Additional considerations",id:"additional-considerations",level:2}];function u(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Scala CLI allows to easly compile and run Scala Scripts.\nIt also allows for straightforward compilation with Scala Native.\nScala Native is an ahead-of-time compiler to native binary allowing\nfor instant startup times, meaning that along with scala-cli, it should\nperfectly suit the needs of a fast scripting tool."}),"\n",(0,i.jsx)(t.h2,{id:"using-scala-native",children:"Using Scala Native"}),"\n",(0,i.jsx)(t.p,{children:"As an example, let\u2019s build a script printing files from\na directory with sizes bigger than a passed value."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",metastring:"title=size-higher-than.scala",children:"//> using scala 3\n//> using dep com.lihaoyi::os-lib::0.11.3\n \n@main\ndef sizeHigherThan(dir: String, minSizeMB: Int) =\n  val wd = os.pwd / dir\n  val files = os.walk.attrs(wd).collect{\n    case (p, attrs) if attrs.size > minSizeMB * 10E6 => p\n  }\n  files.foreach(println(_))\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Running this for a ",(0,i.jsx)(t.code,{children:"dir"})," directory and 20 MB as a lower limit with\n",(0,i.jsx)(t.code,{children:"scala-cli size-higher-than.scala \u2013 dir 20"})," can give us for example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",metastring:"title=dir/large-file.txt",children:"(>20MB of text)\n"})}),"\n",(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"scala-cli size-higher-than.scala -- dir 20\n"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"Compiling project (Scala 3.5.2, JVM)\nCompiled project (Scala 3.5.2, JVM)\n/Users/user/Documents/workspace/dir/large-file.txt\n"})})]}),"\n",(0,i.jsxs)(t.p,{children:["A keen eye will notice that we have not yet compiled to Scala Native. We are still running on the JVM!\nWe can fix that by either running with a ",(0,i.jsx)(t.code,{children:"\u2014-native"})," option, or,\nin this case, by including an additional using directive:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",metastring:"compile title=size-higher-than.scala",children:"//> using dep com.lihaoyi::os-lib::0.10.0\n//> using platform scala-native\n \n@main\ndef sizeHigherThan(dir: String, minSizeMB: Int) =\n  val wd = os.pwd / dir\n  val files = os.walk.attrs(wd).collect{\n    case (p, attrs) if attrs.size > minSizeMB * 10E6 => p\n  }\n  files.foreach(println(_))\n"})}),"\n",(0,i.jsx)(t.p,{children:"After rerunning, you may notice that while the initial compilation took a little longer,\nsubsequent runs will severely cut on the startup time compared to the JVM."}),"\n",(0,i.jsx)(t.h2,{id:"optimization-options",children:"Optimization options"}),"\n",(0,i.jsx)(t.p,{children:"We can make the runtime itself even faster, using various Scala Native optimization options:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"debug"})," - what was used by default up to this point, fast compilation with a slower runtime"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"release-fast"})," - moderate compilation time with a faster runtime"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"release-full"})," - slow compilation time with the fastest runtime"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["We pass these using a ",(0,i.jsx)(t.code,{children:"-\u2013native-mode"})," scala-cli option or, like previously, by adding a using directive:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-scala",metastring:"compile title=size-higher-than.scala",children:"//> using dep com.lihaoyi::os-lib::0.11.3\n//> using platform scala-native\n//> using nativeMode release-full\n \n@main\ndef sizeHigherThan(dir: String, minSizeMB: Int) =\n  val wd = os.pwd / dir\n  val files = os.walk.attrs(wd).collect{\n    case (p, attrs) if attrs.size > minSizeMB * 10E6 => p\n  }\n  files.foreach(println(_))\n"})}),"\n",(0,i.jsxs)(t.p,{children:["We can also package this script into a separate binary with the ",(0,i.jsx)(t.code,{children:"package"})," command,\nuseful especially on Windows where typically shebangs won\u2019t work:"]}),"\n",(0,i.jsx)(t.h2,{id:"additional-considerations",children:"Additional considerations"}),"\n",(0,i.jsx)(t.p,{children:"Some things to look out for when working with Scala Native:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["dependencies - libraries have to be published separately for Scala Native. Notice the ",(0,i.jsx)(t.code,{children:"org::project::version"})," double colon syntax used for os-lib - it basically hides ",(0,i.jsx)(t.code,{children:"org::project_native[Scala Native binary version]:version"})," underneath. Fortunately, many libraries are already available for Scala Native. However, Java dependencies will not work altogether."]}),"\n",(0,i.jsxs)(t.li,{children:["some ",(0,i.jsx)(t.a,{href:"https://scala-native.readthedocs.io/en/stable/user/lang.html",children:"differences"})," exist when compared to Scala on the JVM."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>r});var n=a(6540);const i={},l=n.createContext(i);function s(e){const t=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(l.Provider,{value:t},e.children)}},9487:(e,t,a)=>{a.d(t,{A:()=>S});var n=a(6540);const i=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,l=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,s=/\.(m3u8)($|\?)/i,r=/\.(mpd)($|\?)/i,o=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,c=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,d=/vimeo\.com\/(?!progressive_redirect).+/,u=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,h=/open\.spotify\.com\/(\w+)\/(\w+)/i,p=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+|(videos?\/|\?video=)\d+)($|\?)/,m=/tiktok\.com\/(?:player\/v1\/|share\/video\/|@[^/]+\/video\/)([0-9]+)/,y=(e,t)=>{if(Array.isArray(e)){for(const a of e){if("string"==typeof a&&y(a,t))return!0;if(y(a.src,t))return!0}return!1}return t(e)},f={html:e=>y(e,e=>i.test(e)||l.test(e)),hls:e=>y(e,e=>s.test(e)),dash:e=>y(e,e=>r.test(e)),mux:e=>o.test(e),youtube:e=>c.test(e),vimeo:e=>d.test(e)&&!l.test(e)&&!s.test(e),wistia:e=>u.test(e),spotify:e=>h.test(e),twitch:e=>p.test(e),tiktok:e=>m.test(e)};var g=n.forwardRef((e,t)=>{const a=i.test(`${e.src}`)?"audio":"video";return n.createElement(a,{...e,ref:t},e.children)});var b=[{key:"hls",name:"hls.js",canPlay:f.hls,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([a.e(4243),a.e(4945),a.e(2262)]).then(a.bind(a,1833)))},{key:"dash",name:"dash.js",canPlay:f.dash,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([a.e(4243),a.e(6395)]).then(a.bind(a,9380)))},{key:"mux",name:"Mux",canPlay:f.mux,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([a.e(4243),a.e(4945),a.e(2723)]).then(a.bind(a,994)))},{key:"youtube",name:"YouTube",canPlay:f.youtube,player:(0,n.lazy)(()=>a.e(8446).then(a.bind(a,126)))},{key:"vimeo",name:"Vimeo",canPlay:f.vimeo,player:(0,n.lazy)(()=>a.e(6173).then(a.bind(a,9301)))},{key:"wistia",name:"Wistia",canPlay:f.wistia,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>a.e(9340).then(a.bind(a,9971)))},{key:"spotify",name:"Spotify",canPlay:f.spotify,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>a.e(2771).then(a.bind(a,9422)))},{key:"twitch",name:"Twitch",canPlay:f.twitch,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>a.e(2042).then(a.bind(a,5946)))},{key:"tiktok",name:"TikTok",canPlay:f.tiktok,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>a.e(8085).then(a.bind(a,3173)))},{key:"html",name:"html",canPlay:f.html,canEnablePIP:()=>!0,player:g}];const v={width:"320px",height:"180px",volume:1,playbackRate:1,previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}"},w=n.forwardRef((e,t)=>{const{playing:a,pip:i}=e,l=e.activePlayer,s=(0,n.useRef)(null),r=(0,n.useRef)(!0);(0,n.useEffect)(()=>{var t,n;s.current&&(s.current.paused&&!0===a&&s.current.play(),s.current.paused||!1!==a||s.current.pause(),s.current.playbackRate=null!=(t=e.playbackRate)?t:1,s.current.volume=null!=(n=e.volume)?n:1)}),(0,n.useEffect)(()=>{var e,t,a,n,l;if(s.current&&globalThis.document){if(i&&!document.pictureInPictureElement)try{null==(t=(e=s.current).requestPictureInPicture)||t.call(e)}catch(r){}if(!i&&document.pictureInPictureElement)try{null==(n=(a=s.current).exitPictureInPicture)||n.call(a),null==(l=document.exitPictureInPicture)||l.call(document)}catch(r){}}},[i]);if(!l)return null;const o={},c=["onReady","onStart"];for(const n in e)n.startsWith("on")&&!c.includes(n)&&(o[n]=e[n]);return n.createElement(l,{...o,style:e.style,className:e.className,slot:e.slot,ref:(0,n.useCallback)(e=>{s.current=e,"function"==typeof t?t(e):null!==t&&(t.current=e)},[t]),src:e.src,crossOrigin:e.crossOrigin,preload:e.preload,controls:e.controls,muted:e.muted,autoPlay:e.autoPlay,loop:e.loop,playsInline:e.playsInline,disableRemotePlayback:e.disableRemotePlayback,config:e.config,onLoadStart:t=>{var a,n;r.current=!0,null==(a=e.onReady)||a.call(e),null==(n=e.onLoadStart)||n.call(e,t)},onPlay:t=>{var a,n;r.current&&(r.current=!1,null==(a=e.onStart)||a.call(e,t)),null==(n=e.onPlay)||n.call(e,t)}},e.children)});w.displayName="Player";var x=w;const k=(0,n.lazy)(()=>a.e(6353).then(a.bind(a,9543))),P=[],j=({children:e})=>e;var S=((e,t)=>{const a=n.forwardRef((a,i)=>{const l={...v,...a},{src:s,slot:r,className:o,style:c,width:d,height:u,fallback:h,wrapper:p}=l,[m,y]=(0,n.useState)(!!l.light);(0,n.useEffect)(()=>{l.light?y(!0):y(!1)},[l.light]);const f=e=>{var t;y(!1),null==(t=l.onClickPreview)||t.call(l,e)},g=null==p?j:p,b=!1===h?j:n.Suspense;return n.createElement(g,{slot:r,className:o,style:{width:d,height:u,...c}},n.createElement(b,{fallback:h},m?(e=>{if(!e)return null;const{light:t,playIcon:a,previewTabIndex:i,oEmbedUrl:s,previewAriaLabel:r}=l;return n.createElement(k,{src:e,light:t,playIcon:a,previewTabIndex:i,previewAriaLabel:r,oEmbedUrl:s,onClickPreview:f})})(s):(a=>{var s,c;const d=(a=>{for(const t of[...P,...e])if(a&&t.canPlay(a))return t;return t||null})(a);if(!d)return null;const{style:u,width:h,height:p,wrapper:m}=l,y=null==(s=l.config)?void 0:s[d.key];return n.createElement(x,{...l,ref:i,activePlayer:null!=(c=d.player)?c:d,slot:m?void 0:r,className:m?void 0:o,style:m?{display:"block",width:"100%",height:"100%"}:{display:"block",width:h,height:p,...u},config:y})})(s)))});return a.displayName="ReactPlayer",a.addCustomPlayer=e=>{P.push(e)},a.removeCustomPlayers=()=>{P.length=0},a.canPlay=t=>{if(t)for(const a of[...P,...e])if(a.canPlay(t))return!0;return!1},a.canEnablePIP=t=>{var a;if(t)for(const n of[...P,...e])if(n.canPlay(t)&&(null==(a=n.canEnablePIP)?void 0:a.call(n)))return!0;return!1},a})(b,b[b.length-1])}}]);