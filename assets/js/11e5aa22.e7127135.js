"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3921],{233:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"commands/publishing/publish-setup","title":"Publish Setup \u26a1\ufe0f","description":"The Publish Setup command is restricted and requires setting the --power option to be used.","source":"@site/docs/commands/publishing/publish-setup.md","sourceDirName":"commands/publishing","slug":"/commands/publishing/publish-setup","permalink":"/docs/commands/publishing/publish-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/Virtuslab/scala-cli/edit/main/website/docs/commands/publishing/publish-setup.md","tags":[],"version":"current","sidebarPosition":19,"frontMatter":{"title":"Publish Setup \u26a1\ufe0f","sidebar_position":19},"sidebar":"tutorialSidebar","previous":{"title":"Package \u26a1\ufe0f","permalink":"/docs/commands/package"},"next":{"title":"Publish \u26a1\ufe0f","permalink":"/docs/commands/publishing/publish"}}');var a=s(4848),t=s(8453),o=s(2267);const r={title:"Publish Setup \u26a1\ufe0f",sidebar_position:19},l=void 0,c={},h=[{value:"Configuration",id:"configuration",level:2},{value:"User details",id:"user-details",level:3},{value:"PGP key pair",id:"pgp-key-pair",level:3},{value:"Sonatype credentials",id:"sonatype-credentials",level:3},{value:"GitHub token",id:"github-token",level:3},{value:"Pushing project to GitHub",id:"pushing-project-to-github",level:2},{value:"Local setup",id:"local-setup",level:2},{value:"GitHub actions setup",id:"github-actions-setup",level:2},{value:"GitHub Packages",id:"github-packages",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.admonition,{type:"caution",children:[(0,a.jsxs)(n.p,{children:["The Publish Setup command is restricted and requires setting the ",(0,a.jsx)(n.code,{children:"--power"})," option to be used.\nYou can pass it explicitly or set it globally by running:"]}),(0,a.jsx)(n.p,{children:"scala-cli config power true"})]}),"\n",(0,a.jsxs)(n.admonition,{type:"caution",children:[(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"publish setup"})," sub-command is an experimental feature."]}),(0,a.jsxs)(n.p,{children:["Please bear in mind that non-ideal user experience should be expected.\nIf you encounter any bugs or have feedback to share, make sure to reach out to the maintenance team\non ",(0,a.jsx)(n.a,{href:"https://github.com/VirtusLab/scala-cli",children:"GitHub"}),"."]})]}),"\n","\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"publish setup"})," sub-command configures your project for publishing to Maven repositories,\nsuch as Maven Central or GitHub Packages. It checks that all required parameters for publishing are set, and tries\nto infer many of them from the environment. It writes configuration as using directives, appended\nto a file named ",(0,a.jsx)(n.code,{children:"publish-conf.scala"})," at the root of the workspace."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"publish setup"})," can configure publishing, so that you can publish from your local machine,\nbut also from GitHub actions.\nIn particular, it can upload secrets as GitHub repository secrets, so that only\nminimal effort is required to setup publishing from GitHub actions."]}),"\n",(0,a.jsxs)(n.p,{children:["Running ",(0,a.jsx)(n.code,{children:"publish setup"})," works fine on brand new machines or projects, but it works better when:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"user details, credentials for publishing, and a PGP key are configured (user-wide)"}),"\n",(0,a.jsx)(n.li,{children:"the current project is already pushed to GitHub"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Configuring Scala CLI for publishing makes ",(0,a.jsx)(n.code,{children:"publish setup"})," works more smoothly later on."]}),"\n",(0,a.jsx)(n.p,{children:"In particular, one can configure:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"details about oneself (name, email, website - written in the developers section of POM files)"}),"\n",(0,a.jsx)(n.li,{children:"a PGP key pair (to sign artifacts)"}),"\n",(0,a.jsx)(n.li,{children:"Sonatype credentials (to upload artifacts to Maven Central)"}),"\n",(0,a.jsx)(n.li,{children:"a GitHub token (to upload repository secrets to GitHub, and artifacts to Maven repositories of GitHub Packages)"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["User-wide configuration in Scala CLI is handled by the ",(0,a.jsxs)(n.a,{href:"/docs/commands/config",children:[(0,a.jsx)(n.code,{children:"config"})," command"]}),", and\nthe sections below show how to use it to configure things for ",(0,a.jsx)(n.code,{children:"publish setup"}),"."]}),"\n",(0,a.jsxs)(n.admonition,{type:"caution",children:[(0,a.jsxs)(n.p,{children:["Even though the ",(0,a.jsx)(n.code,{children:"config"})," command is not restricted, some available configuration keys may be, and thus may\nrequire setting the ",(0,a.jsx)(n.code,{children:"--power"})," option to be used.\nThat includes configuration keys tied to publishing, like ",(0,a.jsx)(n.code,{children:"publish.user.name"})," and others.\nYou can pass the ",(0,a.jsx)(n.code,{children:"--power"})," option explicitly or set it globally by running:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli config power true\n"})})]}),"\n",(0,a.jsx)(n.h3,{id:"user-details",children:"User details"}),"\n",(0,a.jsx)(n.p,{children:"Set details with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'scala-cli --power config publish.user.name "Alex Me"\nscala-cli --power config publish.user.email "alex@alex.me"\nscala-cli --power config publish.user.url "https://alex.me"\n'})}),"\n",(0,a.jsx)(n.p,{children:"\x3c!-- clear --\x3e"}),"\n",(0,a.jsx)(n.p,{children:"The email can be left empty if you'd rather not put your email in POM files:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'scala-cli --power config publish.user.email ""\n'})}),"\n",(0,a.jsx)(n.h3,{id:"pgp-key-pair",children:"PGP key pair"}),"\n",(0,a.jsx)(n.p,{children:"Generate a PGP key pair for publishing with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"scala-cli --power config --create-pgp-key --pgp-password MY_CHOSEN_PASSWORD\n"})}),"\n",(0,a.jsx)(n.p,{children:"This sets 2 entries in the Scala CLI configuration, that you can print with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"scala-cli --power config pgp.public-key\nscala-cli --power config pgp.secret-key\n"})}),"\n",(0,a.jsxs)(n.p,{children:["It's not mandatory, although recommended, to use a password to encrypt your keychains.\nTo store the private keychain in an unencrypted form use ",(0,a.jsx)(n.code,{children:"--pgp-password none"}),".\nTo randomly generate a password, use ",(0,a.jsx)(n.code,{children:"--pgp-password random"})," instead."]}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsx)(n.p,{children:"If a password is used, it should be kept safe, as it is needed to later decrypt and use the generated keychains."})}),"\n",(0,a.jsx)(n.h3,{id:"sonatype-credentials",children:"Sonatype credentials"}),"\n",(0,a.jsxs)(n.p,{children:["Publishing to Maven Central requires a Sonatype account, and requesting the right to publish\nunder specific organizations.\nYou can follow the\n",(0,a.jsx)(n.a,{href:"https://github.com/sbt/sbt-ci-release#sonatype",children:"sbt-ci-release Sonatype instructions"}),"\nto create an account there. Either your real Sonatype username and password, or Sonatype tokens, can be used\nin Scala CLI (via the ",(0,a.jsx)(n.code,{children:"publish.credentials"})," config key in both cases)."]}),"\n",(0,a.jsx)(n.p,{children:"These can be written in the Scala CLI configuration the following way:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli config publish.credentials s01.oss.sonatype.org env:SONATYPE_USER env:SONATYPE_PASSWORD --password-value\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Note that both user and password arguments are assumed to be secrets, and\naccept the format documented ",(0,a.jsx)(n.a,{href:"/docs/reference/password-options",children:"here"}),". Beyond environment\nvariables, commands or paths to files can provide those values. They can also be passed\nas is on the command line, although this is not recommended for security reasons."]}),"\n",(0,a.jsxs)(n.p,{children:["In the example above, we pass the username and password via the environment, and\nask the ",(0,a.jsx)(n.code,{children:"config"})," sub-command to read environment variables and persist the password values\n(via ",(0,a.jsx)(n.code,{children:"--password-value"}),")."]}),"\n",(0,a.jsx)(n.p,{children:"If you'd rather persist the environment variable names in the Scala CLI configuration, rather than\ntheir values, you can do"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli --power config publish.credentials s01.oss.sonatype.org env:SONATYPE_USER env:SONATYPE_PASSWORD\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Note that in this case, both ",(0,a.jsx)(n.code,{children:"SONATYPE_USER"})," and ",(0,a.jsx)(n.code,{children:"SONATYPE_PASSWORD"})," will need to be available\nin the environment when using those credentials in the ",(0,a.jsx)(n.code,{children:"publish"})," sub-command."]}),"\n",(0,a.jsx)(n.h3,{id:"github-token",children:"GitHub token"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"publish setup"})," uses a GitHub token in order to:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"upload secrets as GitHub repository secrets"}),"\n",(0,a.jsx)(n.li,{children:"upload artifacts to GitHub packages, when publishing to it"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["To setup a token for Scala CLI, you need to generate a token first.\nFor that, head to your ",(0,a.jsx)(n.a,{href:"https://github.com/settings/tokens",children:"Personal access tokens page"}),',\nand click "Generate new token". The "public_repo" scope is required to upload\nrepository secrets, and the "write',":packages",'" scope is required to upload artifacts\nto GitHub packages.']}),"\n",(0,a.jsx)(n.p,{children:"Once created, copy the token in your clipboard, and run"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:'# macOS\nscala-cli config github.token command:pbpaste --password-value\n# Linux\nscala-cli config github.token "command:xclip -selection clipboard -o" --password-value\n'})}),"\n",(0,a.jsx)(n.h2,{id:"pushing-project-to-github",children:"Pushing project to GitHub"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"publish setup"})," infers some publishing parameters from the GitHub URL of your project.\nIt also uploads repository secrets there, when setting up publishing on GitHub actions."]}),"\n",(0,a.jsxs)(n.p,{children:["To create a new repository from a project, head to ",(0,a.jsx)(n.code,{children:"https://repo.new"}),", pick a name\nfor your project and create the repository. Note its URL, and do"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli default-file .gitignore --write # if you don't have a .gitignore already\ngit init # if git isn't set up already\ngit remote add origin https://github.com/org/name # replace org/name with your freshly created repository values\n"})}),"\n",(0,a.jsx)(n.h2,{id:"local-setup",children:"Local setup"}),"\n",(0,a.jsx)(n.p,{children:"To setup publishing in order to publish from your local machine, you can run"}),"\n",(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli publish setup .\n"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"9 options need to be set\n\norganization:\n  computing io.github.scala-cli from GitHub account scala-cli\nname:\n  using workspace directory name hello-scala-cli\ncomputeVersion:\n  assuming versions are computed from git tags\nrepository:\n  using Maven Central via its s01 server\nlicense:\n  using Apache-2.0 (default)\nurl:\n  computing from GitHub repository scala-cli/hello-scala-cli\nvcs:\n  using GitHub repository scala-cli/hello-scala-cli\ndevelopers:\n  using Alex Me <alex@alex.me> (https://github.com/scala-cli) from config\n\nWrote ./publish-conf.scala\n\nProject is ready for publishing!\nTo publish your project, run\n  scala-cli publish .\n"})})]}),"\n",(0,a.jsx)(n.p,{children:"You can then publish your project from your local machine with"}),"\n",(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli publish .\n"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"Publishing io.github.scala-cli:hello-scala-cli_3:0.1.0-SNAPSHOT\n \u2714 Computed 8 checksums\n \ud83d\ude9a Wrote 12 files\n\n \ud83d\udc40 Check results at\n  https://s01.oss.sonatype.org/content/repositories/snapshots/io/github/scala-cli/hello-scala-cli_3/0.1.0-SNAPSHOT\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"github-actions-setup",children:"GitHub actions setup"}),"\n",(0,a.jsx)(n.p,{children:"To setup publishing from GitHub actions, you can run"}),"\n",(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli publish setup . --ci\n"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"11 options need to be set\n\norganization:\n  computing io.github.scala-cli from GitHub account scala-cli\nname:\n  using workspace directory name hello-scala-cli\ncomputeVersion:\n  assuming versions are computed from git tags\nrepository:\n  using Maven Central via its s01 server\npublish.user:\n  using publish.credentials from Scala CLI configuration\npublish.password:\n  using publish.credentials from Scala CLI configuration\nlicense:\n  using Apache-2.0 (default)\nurl:\n  using GitHub repository https://github.com/scala-cli/hello-scala-cli\nvcs:\n  using GitHub repository scala-cli/hello-scala-cli\ndevelopers:\n  using Alex Me <alex@alex.me> (https://github.com/scala-cli) from config\n\nUploading 4 GitHub repository secrets\n  updated PUBLISH_USER\n  updated PUBLISH_PASSWORD\n  updated PUBLISH_SECRET_KEY\n  updated PUBLISH_SECRET_KEY_PASSWORD\n\nUploaded key 0xe58386629a30f5c5 to http://keyserver.ubuntu.com:11371\n\nWrote ./publish-conf.scala\nWrote workflow in ./.github/workflows/ci.yml\n\nCommit and push ./publish-conf.scala, ./.github/workflows/ci.yml, to enable publishing from CI\n"})})]}),"\n",(0,a.jsxs)(n.p,{children:["Then committing and pushing the suggested files ",(0,a.jsx)(n.code,{children:"publish-conf.scala"})," and ",(0,a.jsx)(n.code,{children:".github/workflows/ci.yml"}),"\nshould trigger a workflow pushing snapshot artifacts to Sonatype Snapshots."]}),"\n",(0,a.jsxs)(n.p,{children:["To publish a non-snapshot version, either push a tag like ",(0,a.jsx)(n.code,{children:"v0.1.0"})," (or any other version with a ",(0,a.jsx)(n.code,{children:"v"}),"\nprefix), or create a release with a tag with the same name from the GitHub UI."]}),"\n",(0,a.jsx)(n.h2,{id:"github-packages",children:"GitHub Packages"}),"\n",(0,a.jsxs)(n.p,{children:["In order to setup publishing to GitHub packages, pass ",(0,a.jsx)(n.code,{children:"--publish-repository github"})," to the\n",(0,a.jsx)(n.code,{children:"publish setup"})," commands above, like"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",metastring:"ignore",children:"scala-cli --power publish setup . --publish-repository github\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},2267:(e,n,s)=>{s.d(n,{Z:()=>o,b:()=>r});s(6540);var i=s(3554),a=s.n(i),t=s(4848);function o(e){let{children:n}=e;return(0,t.jsx)("div",{className:"runnable-command",children:n})}function r(e){let{url:n}=e;return(0,t.jsx)(a(),{playing:!0,loop:!0,muted:!0,controls:!0,width:"100%",height:"",url:n})}}}]);