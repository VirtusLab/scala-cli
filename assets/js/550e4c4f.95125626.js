"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[8061],{1151(e,n,a){a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"type":"mdx","permalink":"/spark","source":"@site/src/pages/spark.md","title":"Experimental Spark features","description":"Packaging","frontMatter":{},"unlisted":false}');var r=a(4848),o=a(8453),l=a(2267);const s={},i="Experimental Spark features",c={},u=[{value:"Packaging",id:"packaging",level:2},{value:"Running Spark jobs",id:"running-spark-jobs",level:2},{value:"Running Spark jobs in a standalone way",id:"running-spark-jobs-in-a-standalone-way",level:2},{value:"Running Hadoop jobs",id:"running-hadoop-jobs",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"experimental-spark-features",children:"Experimental Spark features"})}),"\n","\n",(0,r.jsx)(n.h2,{id:"packaging",children:"Packaging"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"package"})," sub-command offers to package Scala CLI projects as JARs ready to be passed\nto ",(0,r.jsx)(n.code,{children:"spark-submit"}),", and optimized for it."]}),"\n",(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-scala",metastring:"title=SparkJob.scala",children:'//> using dep org.apache.spark::spark-sql:3.0.3\n//> using scala 2.12.15\n\nimport org.apache.spark._\nimport org.apache.spark.sql._\n\nobject SparkJob {\n  def main(args: Array[String]): Unit = {\n    val spark = SparkSession.builder()\n      .appName("Test job")\n      .getOrCreate()\n    import spark.implicits._\n    def sc    = spark.sparkContext\n    val accum = sc.longAccumulator\n    sc.parallelize(1 to 10).foreach(x => accum.add(x))\n    println("Result: " + accum.value)\n  }\n}\n'})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scala-cli --power package --spark SparkJob.scala -o spark-job.jar\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Compiling project (Scala 2.12.15, JVM)\nCompiled project (Scala 2.12.15, JVM)\nWrote spark-job.jar\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"spark-submit spark-job.jar\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"\u2026\nResult: 55\n\u2026\n"})})]}),"\n",(0,r.jsx)(n.h2,{id:"running-spark-jobs",children:"Running Spark jobs"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"run"})," sub-command can run Spark jobs, when passed ",(0,r.jsx)(n.code,{children:"--spark"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scala-cli run --spark SparkJob.scala # same example as above\n"})}),"\n",(0,r.jsx)(n.p,{children:"Note that this requires either"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spark-submit"})," to be in available in ",(0,r.jsx)(n.code,{children:"PATH"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SPARK_HOME"})," to be set in the environment"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"running-spark-jobs-in-a-standalone-way",children:"Running Spark jobs in a standalone way"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"run"})," sub-command can not only run Spark jobs, but it can also work without a Spark\ndistribution. For that to work, it downloads Spark JARs, and calls the main class of\n",(0,r.jsx)(n.code,{children:"spark-submit"})," itself via these JARs:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scala-cli run --spark-standalone SparkJob.scala # same example as above\n"})}),"\n",(0,r.jsx)(n.h2,{id:"running-hadoop-jobs",children:"Running Hadoop jobs"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"run"})," sub-command can run Hadoop jobs, by calling the ",(0,r.jsx)(n.code,{children:"hadoop jar"})," command under-the-hood:"]}),"\n",(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"title=WordCount.java",children:'//> using dep org.apache.hadoop:hadoop-client-api:3.3.3\n\n// from https://hadoop.apache.org/docs/r3.3.3/hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html\n\nimport java.io.IOException;\nimport java.util.StringTokenizer;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\npublic class WordCount {\n\n  public static class TokenizerMapper\n       extends Mapper<Object, Text, Text, IntWritable>{\n\n    private final static IntWritable one = new IntWritable(1);\n    private Text word = new Text();\n\n    public void map(Object key, Text value, Context context\n                    ) throws IOException, InterruptedException {\n      StringTokenizer itr = new StringTokenizer(value.toString());\n      while (itr.hasMoreTokens()) {\n        word.set(itr.nextToken());\n        context.write(word, one);\n      }\n    }\n  }\n\n  public static class IntSumReducer\n       extends Reducer<Text,IntWritable,Text,IntWritable> {\n    private IntWritable result = new IntWritable();\n\n    public void reduce(Text key, Iterable<IntWritable> values,\n                       Context context\n                       ) throws IOException, InterruptedException {\n      int sum = 0;\n      for (IntWritable val : values) {\n        sum += val.get();\n      }\n      result.set(sum);\n      context.write(key, result);\n    }\n  }\n\n  public static void main(String[] args) throws Exception {\n    Configuration conf = new Configuration();\n    Job job = Job.getInstance(conf, "word count");\n    job.setJarByClass(WordCount.class);\n    job.setMapperClass(TokenizerMapper.class);\n    job.setCombinerClass(IntSumReducer.class);\n    job.setReducerClass(IntSumReducer.class);\n    job.setOutputKeyClass(Text.class);\n    job.setOutputValueClass(IntWritable.class);\n    FileInputFormat.addInputPath(job, new Path(args[0]));\n    FileOutputFormat.setOutputPath(job, new Path(args[1]));\n    System.exit(job.waitForCompletion(true) ? 0 : 1);\n  }\n}\n'})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scala-cli run --hadoop WordCount.java\n"})})]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},2267(e,n,a){a.d(n,{Z:()=>o,b:()=>l});a(6540);var t=a(9487),r=a(4848);function o({children:e}){return(0,r.jsx)("div",{className:"runnable-command",children:e})}function l({url:e}){return(0,r.jsx)(t.A,{playing:!0,loop:!0,muted:!0,controls:!0,width:"100%",height:"",url:e})}},8453(e,n,a){a.d(n,{R:()=>l,x:()=>s});var t=a(6540);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}},9487(e,n,a){a.d(n,{A:()=>I});var t=a(6540);const r=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,o=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,l=/\.(m3u8)($|\?)/i,s=/\.(mpd)($|\?)/i,i=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,c=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,u=/vimeo\.com\/(?!progressive_redirect).+/,p=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,d=/open\.spotify\.com\/(\w+)\/(\w+)/i,h=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+|(videos?\/|\?video=)\d+)($|\?)/,m=/tiktok\.com\/(?:player\/v1\/|share\/video\/|@[^/]+\/video\/)([0-9]+)/,b=(e,n)=>{if(Array.isArray(e)){for(const a of e){if("string"==typeof a&&b(a,n))return!0;if(b(a.src,n))return!0}return!1}return n(e)},y={html:e=>b(e,e=>r.test(e)||o.test(e)),hls:e=>b(e,e=>l.test(e)),dash:e=>b(e,e=>s.test(e)),mux:e=>i.test(e),youtube:e=>c.test(e),vimeo:e=>u.test(e)&&!o.test(e)&&!l.test(e),wistia:e=>p.test(e),spotify:e=>d.test(e),twitch:e=>h.test(e),tiktok:e=>m.test(e)};var g=t.forwardRef((e,n)=>{const a=r.test(`${e.src}`)?"audio":"video";return t.createElement(a,{...e,ref:n},e.children)});var x=[{key:"hls",name:"hls.js",canPlay:y.hls,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>Promise.all([a.e(4243),a.e(4945),a.e(2262)]).then(a.bind(a,1833)))},{key:"dash",name:"dash.js",canPlay:y.dash,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>Promise.all([a.e(4243),a.e(6395)]).then(a.bind(a,9380)))},{key:"mux",name:"Mux",canPlay:y.mux,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>Promise.all([a.e(4243),a.e(4945),a.e(2723)]).then(a.bind(a,994)))},{key:"youtube",name:"YouTube",canPlay:y.youtube,player:(0,t.lazy)(()=>a.e(8446).then(a.bind(a,126)))},{key:"vimeo",name:"Vimeo",canPlay:y.vimeo,player:(0,t.lazy)(()=>a.e(6173).then(a.bind(a,9301)))},{key:"wistia",name:"Wistia",canPlay:y.wistia,canEnablePIP:()=>!0,player:(0,t.lazy)(()=>a.e(9340).then(a.bind(a,9971)))},{key:"spotify",name:"Spotify",canPlay:y.spotify,canEnablePIP:()=>!1,player:(0,t.lazy)(()=>a.e(2771).then(a.bind(a,9422)))},{key:"twitch",name:"Twitch",canPlay:y.twitch,canEnablePIP:()=>!1,player:(0,t.lazy)(()=>a.e(2042).then(a.bind(a,5946)))},{key:"tiktok",name:"TikTok",canPlay:y.tiktok,canEnablePIP:()=>!1,player:(0,t.lazy)(()=>a.e(8085).then(a.bind(a,3173)))},{key:"html",name:"html",canPlay:y.html,canEnablePIP:()=>!0,player:g}];const k={width:"320px",height:"180px",volume:1,playbackRate:1,previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}"},j=t.forwardRef((e,n)=>{const{playing:a,pip:r}=e,o=e.activePlayer,l=(0,t.useRef)(null),s=(0,t.useRef)(!0);(0,t.useEffect)(()=>{var n,t;l.current&&(l.current.paused&&!0===a&&l.current.play(),l.current.paused||!1!==a||l.current.pause(),l.current.playbackRate=null!=(n=e.playbackRate)?n:1,l.current.volume=null!=(t=e.volume)?t:1)}),(0,t.useEffect)(()=>{var e,n,a,t,o;if(l.current&&globalThis.document){if(r&&!document.pictureInPictureElement)try{null==(n=(e=l.current).requestPictureInPicture)||n.call(e)}catch(s){}if(!r&&document.pictureInPictureElement)try{null==(t=(a=l.current).exitPictureInPicture)||t.call(a),null==(o=document.exitPictureInPicture)||o.call(document)}catch(s){}}},[r]);if(!o)return null;const i={},c=["onReady","onStart"];for(const t in e)t.startsWith("on")&&!c.includes(t)&&(i[t]=e[t]);return t.createElement(o,{...i,style:e.style,className:e.className,slot:e.slot,ref:(0,t.useCallback)(e=>{l.current=e,"function"==typeof n?n(e):null!==n&&(n.current=e)},[n]),src:e.src,crossOrigin:e.crossOrigin,preload:e.preload,controls:e.controls,muted:e.muted,autoPlay:e.autoPlay,loop:e.loop,playsInline:e.playsInline,disableRemotePlayback:e.disableRemotePlayback,config:e.config,onLoadStart:n=>{var a,t;s.current=!0,null==(a=e.onReady)||a.call(e),null==(t=e.onLoadStart)||t.call(e,n)},onPlay:n=>{var a,t;s.current&&(s.current=!1,null==(a=e.onStart)||a.call(e,n)),null==(t=e.onPlay)||t.call(e,n)}},e.children)});j.displayName="Player";var f=j;const v=(0,t.lazy)(()=>a.e(6353).then(a.bind(a,9543))),w=[],P=({children:e})=>e;var I=((e,n)=>{const a=t.forwardRef((a,r)=>{const o={...k,...a},{src:l,slot:s,className:i,style:c,width:u,height:p,fallback:d,wrapper:h}=o,[m,b]=(0,t.useState)(!!o.light);(0,t.useEffect)(()=>{o.light?b(!0):b(!1)},[o.light]);const y=e=>{var n;b(!1),null==(n=o.onClickPreview)||n.call(o,e)},g=null==h?P:h,x=!1===d?P:t.Suspense;return t.createElement(g,{slot:s,className:i,style:{width:u,height:p,...c}},t.createElement(x,{fallback:d},m?(e=>{if(!e)return null;const{light:n,playIcon:a,previewTabIndex:r,oEmbedUrl:l,previewAriaLabel:s}=o;return t.createElement(v,{src:e,light:n,playIcon:a,previewTabIndex:r,previewAriaLabel:s,oEmbedUrl:l,onClickPreview:y})})(l):(a=>{var l,c;const u=(a=>{for(const n of[...w,...e])if(a&&n.canPlay(a))return n;return n||null})(a);if(!u)return null;const{style:p,width:d,height:h,wrapper:m}=o,b=null==(l=o.config)?void 0:l[u.key];return t.createElement(f,{...o,ref:r,activePlayer:null!=(c=u.player)?c:u,slot:m?void 0:s,className:m?void 0:i,style:m?{display:"block",width:"100%",height:"100%"}:{display:"block",width:d,height:h,...p},config:b})})(l)))});return a.displayName="ReactPlayer",a.addCustomPlayer=e=>{w.push(e)},a.removeCustomPlayers=()=>{w.length=0},a.canPlay=n=>{if(n)for(const a of[...w,...e])if(a.canPlay(n))return!0;return!1},a.canEnablePIP=n=>{var a;if(n)for(const t of[...w,...e])if(t.canPlay(n)&&(null==(a=t.canEnablePIP)?void 0:a.call(t)))return!0;return!1},a})(x,x[x.length-1])}}]);