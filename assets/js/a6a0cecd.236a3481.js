"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[428],{3675(e,t,s){s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"commands/test","title":"Test","description":"The test command runs test suites in the test sources.","source":"@site/docs/commands/test.md","sourceDirName":"commands","slug":"/commands/test","permalink":"/docs/commands/test","draft":false,"unlisted":false,"editUrl":"https://github.com/Virtuslab/scala-cli/edit/main/website/docs/commands/test.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Test","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Run","permalink":"/docs/commands/run"},"next":{"title":"REPL","permalink":"/docs/commands/repl"}}');var a=s(4848),i=s(8453),r=s(2267);const l={title:"Test",sidebar_position:7},c=void 0,o={},d=[{value:"Test sources",id:"test-sources",level:2},{value:"Test directives",id:"test-directives",level:2},{value:"Test framework",id:"test-framework",level:2},{value:"Filter test suite",id:"filter-test-suite",level:2},{value:"Filter test case",id:"filter-test-case",level:2},{value:"Munit",id:"munit",level:3},{value:"Test arguments",id:"test-arguments",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"test"})," command runs test suites in the test sources.\nTest sources are compiled separately (after the 'main' sources), and may use different dependencies, compiler options,\nand other configurations."]}),"\n",(0,a.jsxs)(t.p,{children:["By default, all command line options apply to both the main and test sources,\nso ",(0,a.jsx)(t.a,{href:"/docs/guides/introduction/using-directives",children:"using directives"})," can be used to provide test-specific configurations."]}),"\n",(0,a.jsx)(t.h2,{id:"test-sources",children:"Test sources"}),"\n",(0,a.jsx)(t.p,{children:"A source file is treated as test source if:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["the file name ends with ",(0,a.jsx)(t.code,{children:".test.scala"}),", or"]}),"\n",(0,a.jsxs)(t.li,{children:["the file comes from a directory that is provided as input, and the relative path from that file to its original\ndirectory contains a ",(0,a.jsx)(t.code,{children:"test"})," directory, or"]}),"\n",(0,a.jsxs)(t.li,{children:["it contains the ",(0,a.jsx)(t.code,{children:"//> using target.scope test"})," directive"]}),"\n"]}),"\n",(0,a.jsx)(t.admonition,{type:"caution",children:(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"using target"})," directives are an experimental feature, and may change in future versions of Scala CLI."]})}),"\n",(0,a.jsx)(t.p,{children:"The second rule may sound a bit complicated, so let's explain it using following directory structure:"}),"\n",(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:"ignore",children:"tree example\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",children:"example\n\u251c\u2500\u2500 a.scala\n\u251c\u2500\u2500 a.test.scala\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 main\n    \u2502   \u2514\u2500\u2500 scala\n    \u2502       \u2514\u2500\u2500 d.scala\n    \u251c\u2500\u2500 test\n    \u2502   \u2514\u2500\u2500 scala\n    \u2502       \u2514\u2500\u2500 b.scala\n    \u2514\u2500\u2500 test_unit\n        \u2514\u2500\u2500 scala\n            \u2514\u2500\u2500 e.scala\n"})})]}),"\n",(0,a.jsx)(t.p,{children:"Given that directory structure, let's analyze what file(s) will be treated as tests based on the provided inputs."}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"scala-cli example"})," results in the following files being treated as test sources:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"a.test.scala"}),", since it ends with ",(0,a.jsx)(t.code,{children:".test.scala"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"src/test/scala/b.scala"}),", since the path to that directory contains a directory named ",(0,a.jsx)(t.code,{children:"test"})]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Note that ",(0,a.jsx)(t.code,{children:"e.scala"})," is not treated as a test source since it lacks a parent directory in its relative path that is\nexactly named ",(0,a.jsx)(t.code,{children:"test"})," (the name",(0,a.jsx)(t.code,{children:"test_unit"})," starts with ",(0,a.jsx)(t.code,{children:"test"}),", but Scala CLI only looks for parent directories on the\nrelative path with the exact name ",(0,a.jsx)(t.code,{children:"test"}),")."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"scala-cli example/src"})," results in ",(0,a.jsx)(t.code,{children:"src/test/scala/b.scala"})," being treated as a test file since its relative\npath (",(0,a.jsx)(t.code,{children:"test/scala/b.scala"}),") contains a directory named ",(0,a.jsx)(t.code,{children:"test"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Conversely, ",(0,a.jsx)(t.code,{children:"scala-cli example/src/test"})," results in no test sources, since the relative path to ",(0,a.jsx)(t.code,{children:"b.scala"})," does not\ncontain ",(0,a.jsx)(t.code,{children:"test"})," (the fact that the directory provided as input is named ",(0,a.jsx)(t.code,{children:"test"})," does not make its content a test source)."]}),"\n",(0,a.jsxs)(t.p,{children:["Directives take precedence over file or path names, so ",(0,a.jsx)(t.code,{children:"using target.scope main"})," can be used to force ",(0,a.jsx)(t.code,{children:"test/a.scala"}),"\nor ",(0,a.jsx)(t.code,{children:"a.test.scala"})," to not be treated as tests."]}),"\n",(0,a.jsxs)(t.p,{children:["As a rule of thumb, we recommend naming all of your test files with the ",(0,a.jsx)(t.code,{children:".test.scala"})," suffix."]}),"\n",(0,a.jsx)(t.h2,{id:"test-directives",children:"Test directives"}),"\n",(0,a.jsxs)(t.p,{children:["When configuring your tests with ",(0,a.jsx)(t.code,{children:"using"})," directives, it's usually advised to use their test scope equivalents, so that\nonly tests are affected."]}),"\n",(0,a.jsxs)(t.p,{children:["For example, when declaring a test framework dependency, in most cases you wouldn't need it\nwhen running your whole app, you only need it in tests. So rather than declare it globally with ",(0,a.jsx)(t.code,{children:"using dep"}),", you can use\nthe ",(0,a.jsx)(t.code,{children:"test.dep"})," directive:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"compile",children:"//> using test.dep org.scalameta::munit::1.0.2\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details on test directives,\nsee ",(0,a.jsxs)(t.a,{href:"/docs/guides/introduction/using-directives#directives-with-a-test-scope-equivalent",children:["the ",(0,a.jsx)(t.code,{children:"using"})," directives guide"]}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"test-framework",children:"Test framework"}),"\n",(0,a.jsx)(t.p,{children:"In order to run tests with a test framework, add the framework dependency to your application.\nSome of the most popular test frameworks in Scala are:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://scalameta.org/munit",children:"munit"}),": ",(0,a.jsx)(t.code,{children:"org.scalameta::munit::1.0.2"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://github.com/com-lihaoyi/utest",children:"utest"}),": ",(0,a.jsx)(t.code,{children:"com.lihaoyi::utest::0.8.4"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://www.scalatest.org",children:"ScalaTest"}),": ",(0,a.jsx)(t.code,{children:"org.scalatest::scalatest::3.2.19"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://junit.org/junit4",children:"JUnit 4"}),", which can be used via\na ",(0,a.jsx)(t.a,{href:"https://github.com/sbt/junit-interface",children:"dedicated interface"}),": ",(0,a.jsx)(t.code,{children:"com.github.sbt:junit-interface:0.13.3"})]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"https://disneystreaming.github.io/weaver-test/",children:"Weaver"}),": ",(0,a.jsx)(t.code,{children:"com.disneystreaming::weaver-cats:0.8.3"}),". You may need to\nspecify weaver's test framework with ",(0,a.jsx)(t.code,{children:"//> using testFramework weaver.framework.CatsEffect"})," if you had other test\nframework in your dependencies."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The following example shows how to run an munit-based test suite:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"title=MyTests.test.scala",children:'//> using test.dep org.scalameta::munit::1.0.2\n\nclass MyTests extends munit.FunSuite {\n  test("foo") {\n    assert(2 + 2 == 4)\n  }\n}\n'})}),"\n",(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"scala-cli test MyTests.test.scala\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",children:"Compiling project (1 Scala source)\nCompiled project\nMyTests:\n  + foo 0.143s\n"})})]}),"\n",(0,a.jsx)(t.h2,{id:"filter-test-suite",children:"Filter test suite"}),"\n",(0,a.jsxs)(t.p,{children:["Passing the ",(0,a.jsx)(t.code,{children:"--test-only"})," option to the ",(0,a.jsx)(t.code,{children:"test"})," sub-command filters the test suites to be run:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"title=BarTests.test.scala",children:'//> using test.dep org.scalameta::munit::1.0.2\npackage tests.only\n\nclass BarTests extends munit.FunSuite {\n  test("bar") {\n    assert(2 + 3 == 5)\n  }\n}\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"title=HelloTests.test.scala",children:'package tests\n\nclass HelloTests extends munit.FunSuite {\n  test("hello") {\n    assert(2 + 2 == 4)\n  }\n}\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"scala-cli test . --test-only 'tests.only*' \n# tests.only.BarTests:\n#   + bar 0.045s\n"})}),"\n",(0,a.jsx)(t.h2,{id:"filter-test-case",children:"Filter test case"}),"\n",(0,a.jsx)(t.h3,{id:"munit",children:"Munit"}),"\n",(0,a.jsxs)(t.p,{children:["To run a specific test case inside the unit test suite pass ",(0,a.jsx)(t.code,{children:"*exact-test-name*"})," as an argument to scala-cli:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"title=BarTests.test.scala",children:'//> using test.dep org.scalameta::munit::1.0.2\npackage tests.only\n\nclass Tests extends munit.FunSuite {\n  test("bar") {\n    assert(2 + 2 == 5)\n  }\n  test("foo") {\n    assert(2 + 3 == 5)\n  }\n  test("foo-again") {\n    assert(2 + 3 == 5)\n  }\n}\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"scala-cli test . --test-only 'tests.only*'  -- '*foo*'\n# tests.only.Tests:\n#   + foo 0.045s\n#   + foo-again 0.001s\n"})}),"\n",(0,a.jsx)(t.h2,{id:"test-arguments",children:"Test arguments"}),"\n",(0,a.jsxs)(t.p,{children:["You can pass test arguments to your test framework by passing them after ",(0,a.jsx)(t.code,{children:"--"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-scala",metastring:"title=MyTests.test.scala",children:'//> using test.dep org.scalatest::scalatest::3.2.19\n\nimport org.scalatest._\nimport org.scalatest.flatspec._\nimport org.scalatest.matchers._\n\nclass Tests extends AnyFlatSpec with should.Matchers {\n  "A thing" should "thing" in {\n    assert(2 + 2 == 4)\n  }\n}\n'})}),"\n",(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"scala-cli test MyTests.test.scala -- -oD\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",children:"Compiling project (1 Scala source)\nCompiled project\nTests:\nA thing\n- should thing (22 milliseconds)\nRun completed in 359 milliseconds.\nTotal number of tests run: 1\nSuites: completed 1, aborted 0\nTests: succeeded 1, failed 0, canceled 0, ignored 0, pending 0\nAll tests passed.\n"})})]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},2267(e,t,s){s.d(t,{Z:()=>i,b:()=>r});s(6540);var n=s(9487),a=s(4848);function i({children:e}){return(0,a.jsx)("div",{className:"runnable-command",children:e})}function r({url:e}){return(0,a.jsx)(n.A,{playing:!0,loop:!0,muted:!0,controls:!0,width:"100%",height:"",url:e})}},8453(e,t,s){s.d(t,{R:()=>r,x:()=>l});var n=s(6540);const a={},i=n.createContext(a);function r(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(i.Provider,{value:t},e.children)}},9487(e,t,s){s.d(t,{A:()=>T});var n=s(6540);const a=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,i=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,r=/\.(m3u8)($|\?)/i,l=/\.(mpd)($|\?)/i,c=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,o=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,d=/vimeo\.com\/(?!progressive_redirect).+/,u=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,h=/open\.spotify\.com\/(\w+)\/(\w+)/i,m=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+|(videos?\/|\?video=)\d+)($|\?)/,p=/tiktok\.com\/(?:player\/v1\/|share\/video\/|@[^/]+\/video\/)([0-9]+)/,x=(e,t)=>{if(Array.isArray(e)){for(const s of e){if("string"==typeof s&&x(s,t))return!0;if(x(s.src,t))return!0}return!1}return t(e)},y={html:e=>x(e,e=>a.test(e)||i.test(e)),hls:e=>x(e,e=>r.test(e)),dash:e=>x(e,e=>l.test(e)),mux:e=>c.test(e),youtube:e=>o.test(e),vimeo:e=>d.test(e)&&!i.test(e)&&!r.test(e),wistia:e=>u.test(e),spotify:e=>h.test(e),twitch:e=>m.test(e),tiktok:e=>p.test(e)};var f=n.forwardRef((e,t)=>{const s=a.test(`${e.src}`)?"audio":"video";return n.createElement(s,{...e,ref:t},e.children)});var g=[{key:"hls",name:"hls.js",canPlay:y.hls,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([s.e(4243),s.e(4945),s.e(2262)]).then(s.bind(s,1833)))},{key:"dash",name:"dash.js",canPlay:y.dash,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([s.e(4243),s.e(6395)]).then(s.bind(s,9380)))},{key:"mux",name:"Mux",canPlay:y.mux,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>Promise.all([s.e(4243),s.e(4945),s.e(2723)]).then(s.bind(s,994)))},{key:"youtube",name:"YouTube",canPlay:y.youtube,player:(0,n.lazy)(()=>s.e(8446).then(s.bind(s,126)))},{key:"vimeo",name:"Vimeo",canPlay:y.vimeo,player:(0,n.lazy)(()=>s.e(6173).then(s.bind(s,9301)))},{key:"wistia",name:"Wistia",canPlay:y.wistia,canEnablePIP:()=>!0,player:(0,n.lazy)(()=>s.e(9340).then(s.bind(s,9971)))},{key:"spotify",name:"Spotify",canPlay:y.spotify,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>s.e(2771).then(s.bind(s,9422)))},{key:"twitch",name:"Twitch",canPlay:y.twitch,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>s.e(2042).then(s.bind(s,5946)))},{key:"tiktok",name:"TikTok",canPlay:y.tiktok,canEnablePIP:()=>!1,player:(0,n.lazy)(()=>s.e(8085).then(s.bind(s,3173)))},{key:"html",name:"html",canPlay:y.html,canEnablePIP:()=>!0,player:f}];const j={width:"320px",height:"180px",volume:1,playbackRate:1,previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}"},b=n.forwardRef((e,t)=>{const{playing:s,pip:a}=e,i=e.activePlayer,r=(0,n.useRef)(null),l=(0,n.useRef)(!0);(0,n.useEffect)(()=>{var t,n;r.current&&(r.current.paused&&!0===s&&r.current.play(),r.current.paused||!1!==s||r.current.pause(),r.current.playbackRate=null!=(t=e.playbackRate)?t:1,r.current.volume=null!=(n=e.volume)?n:1)}),(0,n.useEffect)(()=>{var e,t,s,n,i;if(r.current&&globalThis.document){if(a&&!document.pictureInPictureElement)try{null==(t=(e=r.current).requestPictureInPicture)||t.call(e)}catch(l){}if(!a&&document.pictureInPictureElement)try{null==(n=(s=r.current).exitPictureInPicture)||n.call(s),null==(i=document.exitPictureInPicture)||i.call(document)}catch(l){}}},[a]);if(!i)return null;const c={},o=["onReady","onStart"];for(const n in e)n.startsWith("on")&&!o.includes(n)&&(c[n]=e[n]);return n.createElement(i,{...c,style:e.style,className:e.className,slot:e.slot,ref:(0,n.useCallback)(e=>{r.current=e,"function"==typeof t?t(e):null!==t&&(t.current=e)},[t]),src:e.src,crossOrigin:e.crossOrigin,preload:e.preload,controls:e.controls,muted:e.muted,autoPlay:e.autoPlay,loop:e.loop,playsInline:e.playsInline,disableRemotePlayback:e.disableRemotePlayback,config:e.config,onLoadStart:t=>{var s,n;l.current=!0,null==(s=e.onReady)||s.call(e),null==(n=e.onLoadStart)||n.call(e,t)},onPlay:t=>{var s,n;l.current&&(l.current=!1,null==(s=e.onStart)||s.call(e,t)),null==(n=e.onPlay)||n.call(e,t)}},e.children)});b.displayName="Player";var v=b;const w=(0,n.lazy)(()=>s.e(6353).then(s.bind(s,9543))),P=[],k=({children:e})=>e;var T=((e,t)=>{const s=n.forwardRef((s,a)=>{const i={...j,...s},{src:r,slot:l,className:c,style:o,width:d,height:u,fallback:h,wrapper:m}=i,[p,x]=(0,n.useState)(!!i.light);(0,n.useEffect)(()=>{i.light?x(!0):x(!1)},[i.light]);const y=e=>{var t;x(!1),null==(t=i.onClickPreview)||t.call(i,e)},f=null==m?k:m,g=!1===h?k:n.Suspense;return n.createElement(f,{slot:l,className:c,style:{width:d,height:u,...o}},n.createElement(g,{fallback:h},p?(e=>{if(!e)return null;const{light:t,playIcon:s,previewTabIndex:a,oEmbedUrl:r,previewAriaLabel:l}=i;return n.createElement(w,{src:e,light:t,playIcon:s,previewTabIndex:a,previewAriaLabel:l,oEmbedUrl:r,onClickPreview:y})})(r):(s=>{var r,o;const d=(s=>{for(const t of[...P,...e])if(s&&t.canPlay(s))return t;return t||null})(s);if(!d)return null;const{style:u,width:h,height:m,wrapper:p}=i,x=null==(r=i.config)?void 0:r[d.key];return n.createElement(v,{...i,ref:a,activePlayer:null!=(o=d.player)?o:d,slot:p?void 0:l,className:p?void 0:c,style:p?{display:"block",width:"100%",height:"100%"}:{display:"block",width:h,height:m,...u},config:x})})(r)))});return s.displayName="ReactPlayer",s.addCustomPlayer=e=>{P.push(e)},s.removeCustomPlayers=()=>{P.length=0},s.canPlay=t=>{if(t)for(const s of[...P,...e])if(s.canPlay(t))return!0;return!1},s.canEnablePIP=t=>{var s;if(t)for(const n of[...P,...e])if(n.canPlay(t)&&(null==(s=n.canEnablePIP)?void 0:s.call(n)))return!0;return!1},s})(g,g[g.length-1])}}]);